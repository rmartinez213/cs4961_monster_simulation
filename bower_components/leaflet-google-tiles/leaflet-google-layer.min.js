!function e(t,o,i){function n(r,a){if(!o[r]){if(!t[r]){var l="function"==typeof require&&require;if(!a&&l)return l(r,!0);if(s)return s(r,!0);var u=new Error("Cannot find module '"+r+"'");throw u.code="MODULE_NOT_FOUND",u}var h=o[r]={exports:{}};t[r][0].call(h.exports,function(e){var o=t[r][1][e];return n(o?o:e)},h,h.exports,e,t,o,i)}return o[r].exports}for(var s="function"==typeof require&&require,r=0;r<i.length;r++)n(i[r]);return n}({1:[function(e,t,o){(function(e){var o="undefined"!=typeof window?window.L:"undefined"!=typeof e?e.L:null,i=["roadmap","satellite"];o.TileLayer.Google=o.TileLayer.extend({options:{GoogleTileAPIKey:null,mapType:"roadmap",language:"en-GB",region:"gb"},statics:{TILE_REQUEST:"https://www.googleapis.com/tile/v1/tiles/{z}/{x}/{y}?session={sessionToken}&orientation=0&key={GoogleTileAPIKey}",ATTRIBUTION_URL:"https://www.googleapis.com/tile/v1/viewport?session={sessionToken}&zoom={zoom}&north={north}&south={south}&east={east}&west={west}&key={GoogleTileAPIKey}",SESSION_TOKEN_URL:"https://www.googleapis.com/tile/v1/createSession?key={GoogleTileAPIKey}"},_getSessionToken:function(){var e=this;return this._exponentialBackoff||(this._exponentialBackoff=1e3),this._promise||(this._promise=new Promise(function(t,i){var n=o.Util.template(o.TileLayer.Google.SESSION_TOKEN_URL,{GoogleTileAPIKey:e.options.GoogleTileAPIKey}),s=JSON.stringify({mapType:e.options.mapType,language:e.options.language,region:e.options.region,overlay:!0,scale:"scaleFactor1x"}),r=new XMLHttpRequest;r.open("POST",n,!0),r.setRequestHeader("Content-type","application/json"),r.onreadystatechange=function(){if(4===this.readyState)if(200===this.status){e._exponentialBackoff=null;var o=JSON.parse(r.responseText);e._sessionToken=o.session,t(o)}else setTimeout(function(){e._promise=null,e._exponentialBackoff*=2,e._getSessionToken()},e._exponentialBackoff),i("Session request failed, trying again in "+e._exponentialBackoff/1e3+"seconds")},r.send(s)})),this._promise},_refreshToken:function(){var e=this;this._getSessionToken().then(function(t){setTimeout(function(){e._needToRefreshToken&&(e._promise=null,e._refreshToken())},1e3*t.expiry-(new Date).getTime()-36e5)})["catch"](function(e){console.error("refreshToken",e)})},initialize:function(e){if(!e||!e.GoogleTileAPIKey)throw new Error("Must supply options.GoogleTileAPIKey");if(e=o.setOptions(this,e),i.indexOf(e.mapType)<0)throw new Error("'"+e.mapType+"' is an invalid mapType");this._sessionToken=null,this._needToRefreshToken=!1,this._promise=null,o.Browser.android||this.on("tileunload",this._onTileRemove)},createTile:function(e,t){var i=document.createElement("img");return o.DomEvent.on(i,"load",o.bind(this._tileOnLoad,this,t,i)),o.DomEvent.on(i,"error",o.bind(this._tileOnError,this,t,i)),this.options.crossOrigin&&(i.crossOrigin=""),i.alt="",this._getSessionToken().then(function(o){i.src=this.getTileUrl(e),t(null,i)}.bind(this))["catch"](function(e){console.error(e),t(e)}),i},getAttribution:function(){return this.attribution},getTileUrl:function(e){return o.Util.template(o.TileLayer.Google.TILE_REQUEST,{z:e.z,x:e.x,y:e.y,sessionToken:this._sessionToken,GoogleTileAPIKey:this.options.GoogleTileAPIKey})},onAdd:function(e){e.on("moveend",this._updateAttribution,this),o.TileLayer.prototype.onAdd.call(this,e),this._needToRefreshToken=!0,this._refreshToken(),this._updateAttribution()},onRemove:function(e){e.off("moveend",this._updateAttribution,this),this._needToRefreshToken=!1,this._promise=null,e.attributionControl.removeAttribution(this.attribution),this.attribution=null,o.TileLayer.prototype.onRemove.call(this,e)},setKey:function(e){e&&this.options.GoogleTileAPIKey!==e&&(this.options.GoogleTileAPIKey=e,this._getSessionToken().then(function(){this.redraw()}.bind(this)))},setLanguage:function(e){e&&this.options.language!==e&&(this.options.language=e,this._promise=null,this._getSessionToken().then(function(){this.redraw(),this._updateAttribution()}.bind(this)))},setMapType:function(e){if(!e||-1===i.indexOf(e))throw new Error("'"+e+"' is an invalid mapType");this.options.mapType!==e&&(this.options.mapType=e,this._promise=null,this._getSessionToken().then(function(){this.redraw(),this._updateAttribution()}.bind(this)))},setRegion:function(e){e&&this.options.region!==e&&(this.options.region=e,this._promise=null,this._getSessionToken().then(function(){this.redraw(),this._updateAttribution()}.bind(this)))},_getAttributionUrl:function(){var e=this._map,t=e.getZoom(),i=e.getBounds().toBBoxString().split(",");return o.Util.template(o.TileLayer.Google.ATTRIBUTION_URL,{GoogleTileAPIKey:this.options.GoogleTileAPIKey,sessionToken:this._sessionToken,zoom:t,south:i[0],east:i[1],north:i[2],west:i[3]})},_makeGetRequest:function(e,t){e.open("GET",t,!0),e.send()},_updateAttribution:function(e){var t=this._map,o=this;t&&t.attributionControl&&this._getSessionToken().then(function(){var i=o._getAttributionUrl();o._exponentialTimeout=1e3;var n=new XMLHttpRequest;n.onreadystatechange=function(){4===this.readyState&&200===this.status?(t.attributionControl.removeAttribution(o.attribution),o.attribution=JSON.parse(this.responseText).copyright,t.attributionControl.addAttribution(o.attribution),e&&!e.target&&e(null,o.attribution)):4===this.readyState&&(console.error("Attribution request unsuccessful, retrying in "+o._exponentialTimeout/1e3+" seconds"),setTimeout(function(){o._exponentialTimeout*=2,o._makeGetRequest(n,i)},o._exponentialTimeout))},o._makeGetRequest(n,i)}.bind(this))["catch"](function(t){e&&!e.target&&e(t),console.error("updateAttribution",t)})}}),o.tileLayer.google=function(e){return new o.TileLayer.Google(e)},t.exports=o.TileLayer.Google}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{}]},{},[1]);